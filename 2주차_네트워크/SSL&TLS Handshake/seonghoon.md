# TLS & SSL HandShake, 왜 이게 필요했는지

# SSL/TLS Handshake의 등장 배경

- 공개키 암호화 방식은 컴퓨터 자원에 성능적인 부담을 줄 수 밖에 없다.
- 또한, 그렇다고 무턱대고 대칭키 암호화 방식을 사용하기에는 대칭키를 안전하게 전달하는 것이 어려워, 데이터의 기밀성이 보장되지 않을 수 있다.
- 이에 대한 대안으로, 대칭키로 통신을 하고 싶은데 이 **대칭키를 안전하게 전달**하기 위해서 등장
- 결론적으로, **암호화된 데이터를 전송하기 위해서 공개키와 대칭키를 혼합해서 사용**한다.

# SSL/TLS Handshake의 과정

TCP 3-way Handshake 이후에 진행

1. Client Hello (클라이언트가 서버에게 Hello) ; 다음 세 가지 정보를 전달
- 클라이언트 측에서 생성한 랜덤 데이터
- 클라이언트가 지원하는 암호화 방식들
- 세션 아이디를 전달
1. Server Hello (서버가 클라이언트에게 Hello) ; 다음 세 가지 정보를 전달
- 서버 측에서 생성한 랜덤 데이터
- 서버가 선택한 클라이언트의 암호화 방식
- 인증서 (공개키를 포함한)
1. 클라이언트는 **서버로부터 받은 인증서가 CA에 의해서 발급된 것인지 확인** (클라이언트에 내장된 CA의 공개키를 이용해서 인증서를 복호화 해봄, 만약 복호화에 실패했다면 신뢰할 수 없는 서버 )

클라이언트는 2번을 통해 받은 서버의 랜덤데이터와 클라이언트의 랜덤데이터를 조합하여 pre master secret이라는 키를 생성(이때, 이 키는 세션 단계에서 데이터를 암호화하기 위해서 사용될 것이므로 절대 제 3자에게 노출되어서는 안됨)

그럼 pre master secret 값을 어떻게 서버에게 안전하게 전달할 수 있을까?
→ **인증서에 포함되었던 서버의 공개키로 암호화**한 후 서버로 전달한다.
2. 서버는 클라이언트로부터 받은 pre master secret 값을 자신의 비공개키로 복호화함으로써, 양 측이 모두 pre master secret 값을 공유하게 됨

이후 양측은 pre master secret → master secret 으로 만들고, 이는 다시 session key를 생성하는데에 쓰임

이 session key를 이용해서 서버와 클라이언트는 데이터를 대칭키 방식으로 암호화 한 후에 주고받음
3. 클라이언트와 서버는 handshake의 종료를 서로에게 알림

[HTTPS와 SSL 인증서 - 생활코딩](https://opentutorials.org/course/228/4894)

[SSL, TLS, HTTPS Explained](https://www.youtube.com/watch?v=j9QmMEWmcfo&t=279s)